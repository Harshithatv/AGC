generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  SYSTEM_ADMIN
  ORG_ADMIN
  ORG_USER
}

enum ModuleStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}

enum ModuleMediaType {
  VIDEO
  PRESENTATION
  PDF
  DOCUMENT
}

model Organization {
  id         String            @id @default(uuid())
  name       String
  type       String
  maxUsers   Int
  startDate  DateTime
  createdAt  DateTime          @default(now())
  users      User[]
  purchases  PackagePurchase[]
}

model User {
  id           String           @id @default(uuid())
  name         String
  email        String           @unique
  passwordHash String
  role         Role
  organizationId String?
  organization Organization?    @relation(fields: [organizationId], references: [id])
  createdAt    DateTime         @default(now())
  progress     ModuleProgress[]
  fileProgress ModuleFileProgress[]
  createdModules CourseModule[] @relation("CreatedModules")
  purchases    PackagePurchase[]
  certificate  Certificate?
}

model PackagePurchase {
  id             String           @id @default(uuid())
  packageType    String
  purchasedAt    DateTime         @default(now())
  organizationId String
  organization   Organization     @relation(fields: [organizationId], references: [id])
  purchasedById  String
  purchasedBy    User             @relation(fields: [purchasedById], references: [id])
}

model PackagePrice {
  id          String           @id @default(uuid())
  packageType String           @unique
  amount      Int
  maxUsers    Int              @default(1)
  label       String?
  summary     String?
  features   Json?
  highlight  Boolean          @default(false)
  currency    String           @default("INR")
  updatedAt   DateTime         @updatedAt
}

model CourseModule {
  id               String           @id @default(uuid())
  title            String
  description      String
  order            Int              @unique
  deadlineDays     Int
  mediaType        ModuleMediaType
  mediaUrl         String
  createdAt        DateTime         @default(now())
  createdById      String
  createdBy        User             @relation("CreatedModules", fields: [createdById], references: [id])
  progress         ModuleProgress[]
  files            ModuleFile[]
}

model ModuleFile {
  id          String          @id @default(uuid())
  moduleId    String
  module      CourseModule    @relation(fields: [moduleId], references: [id])
  order       Int
  title       String?
  mediaType   ModuleMediaType
  mediaUrl    String
  createdAt   DateTime        @default(now())
  progress    ModuleFileProgress[]

  @@unique([moduleId, order])
}

model ModuleFileProgress {
  id           String        @id @default(uuid())
  userId       String
  user         User          @relation(fields: [userId], references: [id])
  moduleFileId String
  moduleFile   ModuleFile    @relation(fields: [moduleFileId], references: [id])
  status       ModuleStatus  @default(NOT_STARTED)
  startedAt    DateTime?
  completedAt  DateTime?

  @@unique([userId, moduleFileId])
}

model ModuleProgress {
  id          String        @id @default(uuid())
  userId      String
  user        User          @relation(fields: [userId], references: [id])
  moduleId    String
  module      CourseModule  @relation(fields: [moduleId], references: [id])
  status      ModuleStatus  @default(NOT_STARTED)
  startedAt   DateTime?
  completedAt DateTime?

  @@unique([userId, moduleId])
}

model Certificate {
  id           String   @id @default(uuid())
  userId       String   @unique
  user         User     @relation(fields: [userId], references: [id])
  issuedAt     DateTime @default(now())
  totalModules Int
  program      String   @default("Academic Guide Training & Certification")
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
}
